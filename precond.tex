\section{Implication and Preconditions}

Although many enhanced \lstinline{for} loops can be converted to lambda
expressions, there are some precondition to check. For example, lambda
expression bodies cannot reference variables that are not \lstinline{final} or
\emph{effectively} final (i.e., the variable \emph{could have} been marked as final)~\cite{gosling2014java}.  Below are some preconditions that must be followed
before the lambda conversion~\cite{gyori2013}. 

\begin{enumerate}

    \item The conversion must be semantics-preserving. That is, the behavior
        of the program prior to the refactoring must match that of after the
        refactoring.

    \item The \lstinline{for} loop must iterate over an instance of a
        \lstinline{Collection} as this is where \lstinline{stream()} is
        declared.

    \item The body of the initial \lstinline{for} loop must not throw a
        checked exception. 

    \item The body of the initial \lstinline{for} loop must not have more than
        one reference to a local, non-effectively final variable defined
        outside the loop.

    \item The loop body must not contain a \lstinline{break},
        \lstinline{continue} statement as these semantics cannot be expressed
        via a lambda expression.  

\end{enumerate}

From our experience, we believe that these preconditions are sufficient for
the kinds of loops being refactored. It would also be possible to refactor
loops over \lstinline{Iterable}s as it declares \lstinline{forEach()}.
Moreover, it would be helpful to prove the soundness of the approach. We
designate these tasks for future work.
